---
import { Image } from "astro:assets";
import { formattedPrice } from "../../core/utils/formattedPrice";
const { product, loading = "lazy" } = Astro.props;
const image =
    Array.isArray(product.imagenes) && product.imagenes.length > 0
        ? product.imagenes[0]
        : product.image_url || null;
---

<a
    href={`/producto/${product.slug || product.id}`}
    class="product-item group relative block overflow-hidden rounded-2xl bg-card border border-border/50 shadow-sm transition-all duration-300 hover:shadow-xl hover:shadow-primary/5 hover:-translate-y-1"
>
    <!-- Product Image -->
    <div
        class="relative aspect-[4/5] md:aspect-square overflow-hidden bg-secondary/20"
    >
        {
            image ? (
                <Image
                    src={image}
                    alt={product.name}
                    width={400}
                    height={400}
                    transition:name={`image-${product.slug || product.id}`}
                    loading={loading}
                    class="h-full w-full object-contain p-3 md:p-4 transition-transform duration-500 group-hover:scale-105"
                />
            ) : null
        }

        <!-- Placeholder / Fallback -->
        <div
            class="absolute inset-0 flex items-center justify-center text-muted-foreground bg-secondary/20"
            style={image ? "display: none;" : "display: flex;"}
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="48"
                height="48"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="opacity-20"
            >
                <rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect>
                <circle cx="9" cy="9" r="2"></circle>
                <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path>
            </svg>
        </div>

        <!-- Subtle gradient overlay -->
        <div
            class="absolute inset-0 bg-linear-to-t from-black/5 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"
        >
        </div>

        {
            product.stock < 1 && (
                <div class="absolute top-3 left-3 z-10">
                    <span class="inline-flex items-center gap-1 rounded-full bg-destructive/90 px-2.5 py-1 text-xs font-bold text-destructive-foreground shadow-sm uppercase tracking-wider">
                        Agotado
                    </span>
                </div>
            )
        }
    </div>

    <div class="p-3 md:p-5">
        <span
            class="font-sans inline-block mb-1.5 md:mb-2 text-[10px] font-bold text-primary bg-primary/10 px-2.5 py-1 rounded-full uppercase tracking-wider"
        >
            {product.categories?.name || "Sin categor√≠a"}
        </span>

        <h3
            class="font-sans font-semibold text-foreground text-base md:text-lg mb-1 md:mb-2 line-clamp-2 group-hover:text-primary transition-colors duration-200"
        >
            {product.name}
        </h3>

        <div class="mt-2 md:mt-4 flex items-end justify-between">
            <span
                class="font-sans text-lg md:text-xl font-bold text-foreground"
            >
                {formattedPrice(product.price)}
            </span>

            <!-- View Details Arrow -->
            <div
                class="inline-flex items-center justify-center w-7 h-7 md:w-8 md:h-8 rounded-full bg-secondary text-muted-foreground group-hover:bg-primary group-hover:text-primary-foreground transition-all duration-200"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="md:w-4 md:h-4"
                >
                    <path d="m9 18 6-6-6-6"></path>
                </svg>
            </div>
        </div>
    </div>
</a>
