---
import { Image } from "astro:assets";
import SunIcon from "../icons/SunIcon.astro";
import MoonIcon from "../icons/MoonIcon.astro";
import iconImage from "../../assets/icon.png";

const navLinks = [
    { path: "/", label: "Inicio" },
    { path: "/products", label: "Productos" },
];

const currentPath = Astro.url.pathname;
const isActive = (path: string) => currentPath === path;
---

<header
    class="sticky top-0 z-40 w-full bg-background/95 backdrop-blur supports-backdrop-filter:bg-background/60 border-b border-border/50"
>
    <div class="container flex h-16 items-center justify-between gap-4">
        <a href="/" class="flex items-center gap-3 shrink-0">
            <!-- <Image
                src={iconImage}
                alt="Pura Esencia Logo"
                class="h-12 w-auto object-contain"
                loading="eager"
            /> -->
            <span class="font-sans text-xl font-semibold text-foreground">
                Pura <span class="text-primary">Esencia</span>
            </span>
        </a>

        <!-- Desktop Navigation -->
        <nav class="hidden md:flex items-center gap-8">
            {
                navLinks.map((link) => (
                    <a
                        href={link.path}
                        class:list={[
                            "text-sm font-medium transition-colors hover:text-primary",
                            isActive(link.path)
                                ? "text-primary"
                                : "text-muted-foreground",
                        ]}
                    >
                        {link.label}
                    </a>
                ))
            }
        </nav>

        <!-- Theme Toggle - Desktop -->
        <button
            id="theme-toggle-desktop"
            class="hidden md:inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-9 w-9"
        >
            <SunIcon
                class="h-5 w-5 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"
            />
            <MoonIcon
                class="absolute h-5 w-5 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"
            />
            <span class="sr-only">Toggle theme</span>
        </button>

        <!-- Mobile Search & Menu -->
        <div class="flex md:hidden items-center gap-1">
            <button
                id="theme-toggle-mobile"
                class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-9 w-9"
            >
                <SunIcon
                    class="h-5 w-5 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"
                />
                <MoonIcon
                    class="absolute h-5 w-5 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"
                />
                <span class="sr-only">Toggle theme</span>
            </button>
            <button
                id="menu-toggle"
                class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-9 w-9"
            >
                <svg
                    id="menu-icon"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="h-5 w-5 transition-all"
                    ><line x1="4" x2="20" y1="12" y2="12"></line><line
                        x1="4"
                        x2="20"
                        y1="6"
                        y2="6"></line><line x1="4" x2="20" y1="18" y2="18"
                    ></line></svg
                >
                <svg
                    id="close-icon"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="absolute h-5 w-5 transition-all scale-0 opacity-0"
                    ><path d="M18 6 6 18"></path><path d="m6 6 12 12"
                    ></path></svg
                >
            </button>
        </div>
    </div>

    <div
        id="mobile-menu"
        class="hidden md:hidden border-t border-border bg-background animate-fade-in"
    >
        <nav class="container py-4 flex flex-col gap-4">
            {
                navLinks.map((link) => (
                    <a
                        href={link.path}
                        class:list={[
                            "text-sm font-medium transition-colors hover:text-primary",
                            isActive(link.path)
                                ? "text-primary"
                                : "text-muted-foreground",
                        ]}
                    >
                        {link.label}
                    </a>
                ))
            }
        </nav>
    </div>
</header>

<script>
    function setupHeader() {
        const menuToggle = document.getElementById("menu-toggle");
        const mobileMenu = document.getElementById("mobile-menu");
        const menuIcon = document.getElementById("menu-icon");
        const closeIcon = document.getElementById("close-icon");

        const mobileSearch = document.getElementById("mobile-search");

        const themeToggleDesktop = document.getElementById(
            "theme-toggle-desktop",
        );
        const themeToggleMobile = document.getElementById(
            "theme-toggle-mobile",
        );

        menuToggle?.addEventListener("click", () => {
            mobileMenu?.classList.toggle("hidden");

            if (mobileMenu?.classList.contains("hidden")) {
                menuIcon?.classList.remove("scale-0", "opacity-0");
                closeIcon?.classList.add("scale-0", "opacity-0");
            } else {
                menuIcon?.classList.add("scale-0", "opacity-0");
                closeIcon?.classList.remove("scale-0", "opacity-0");
            }

            if (mobileSearch && !mobileSearch.classList.contains("hidden")) {
                mobileSearch.classList.add("hidden");
            }
        });

        const toggleTheme = () => {
            const isDark = document.documentElement.classList.contains("dark");
            if (isDark) {
                document.documentElement.classList.remove("dark");
                localStorage.setItem("theme", "light");
            } else {
                document.documentElement.classList.add("dark");
                localStorage.setItem("theme", "dark");
            }
        };

        themeToggleDesktop?.addEventListener("click", toggleTheme);
        themeToggleMobile?.addEventListener("click", toggleTheme);
    }

    document.addEventListener("astro:page-load", setupHeader);
</script>
