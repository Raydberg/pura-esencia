---
import { supabase } from "../../core/lib/supabase";

import BodyCream from "../icons/BodyCream.astro";
import Deodorant from "../icons/Deodorant.astro";
import DefaultCategory from "../icons/DefaultCategory.astro";
import Fragrance from "../icons/Fragrance.astro";
import KidsCream from "../icons/KidsCream.astro";
import Lipstick from "../icons/Lipstick.astro";
import Makeup from "../icons/Makeup.astro";
import Skincare from "../icons/Skincare.astro";

const { data: dbCategories } = await supabase
    .from("categories")
    .select("id, name")
    .limit(4); 

const categories = (dbCategories || []).map((cat) => {
    const normalized = cat.name
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "");

    let Icon = DefaultCategory;

    if (normalized.includes("maquillaje") || normalized.includes("makeup")) {
        Icon = Makeup;
    } else if (
        normalized.includes("piel") ||
        normalized.includes("skin") ||
        normalized.includes("faciales")
    ) {
        Icon = Skincare;
    } else if (normalized.includes("labial") || normalized.includes("lip")) {
        Icon = Lipstick;
    } else if (
        normalized.includes("perfume") ||
        normalized.includes("fragancia") ||
        normalized.includes("aroma")
    ) {
        Icon = Fragrance;
    } else if (
        normalized.includes("cuerpo") ||
        normalized.includes("corporal")
    ) {
        Icon = BodyCream;
    } else if (
        normalized.includes("niño") ||
        normalized.includes("bebe") ||
        normalized.includes("infantil")
    ) {
        Icon = KidsCream;
    } else if (normalized.includes("desodorante")) {
        Icon = Deodorant;
    }

    return {
        ...cat,
        Icon,
    };
});
---

<section class="py-16 bg-secondary/30">
    <div class="container">
        <h2
            class="font-sans text-3xl font-bold text-foreground mb-10 text-center"
        >
            Nuestras Categorías
        </h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            {
                categories.map((cat) => (
                    <a
                        href={`/products?categoria=${cat.id}`}
                        class="group bg-card hover:bg-primary/5 rounded-xl p-6 text-center border border-border/50 hover:border-primary/30 transition-all hover:shadow-lg hover:-translate-y-1 duration-300 flex flex-col items-center justify-center gap-3"
                    >
                        <div class="text-primary w-10 h-10 group-hover:scale-110 transition-transform duration-300">
                            <cat.Icon class="w-full h-full" />
                        </div>
                        <h3 class="font-sans font-semibold text-lg text-foreground group-hover:text-primary transition-colors">
                            {cat.name}
                        </h3>
                    </a>
                ))
            }
        </div>
    </div>
</section>
